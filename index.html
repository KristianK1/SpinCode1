<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>Zadaća 1 Spin</title>
</head>
<body>
    <div class="long-new-ogranici-sirinu">
        

        <h1 class="naslov">
            Spin Code Academy
        </h1>
        <div class="inputstuff">
            <span>
                <span class="pojam_opis">Pojam</span>
                <input type="text" id="id_pojam">
            </span>
            <span>
                <span class="pojam_opis">Opis</span>
                <input type="text" id="id_des">
            </span>
            <input type = "button" onclick = "insertsmth()" value = "Insert"> 
            <br>
            
        </div>

        <table id="tablica">
            <tr>
                <th>Pojam</th>
                <th>Opis</th>
                <th>Autor</th>
            </tr>
        </table>
    </div>
</body>

<script>
    var allterms;

    getsmth();
    deleteRow();
   /* var cell1 = row.insertCell(0);
    var cell2 = row.insertCell(1);
    var cell3 = row.insertCell(2);
    
    cell1.innerHTML = "Svašta";
    cell2.innerHTML = "Svašta";
    cell3.innerHTML = "qq";*/


    function insertsmth(){
        var pojam=document.getElementById("id_pojam");
        var opis=document.getElementById("id_des");
        console.log(pojam.value);

        fetch("https://jupitermobiletest.jupiter-software.com:30081/jupitermobilex/gen/api/food", {
            method : 'POST',
            body: JSON.stringify({
                "queries": [
                    {
                        "query": "SpinCodeAcademy",
                        "params": {
                            "action": "insert",
                            "userid": 5,
                            "term": pojam.value,
                            "description": opis.value
                        }
                    }
                ]
            }),
            headers : {
            'Content-Type' : 'application/json'
            }
        }).then(function (response){
            if(response.ok){
                
                console.log("uploaded");
                return ;
            }
        }).then( function(){
            emptyTable();
            getsmth();
        }).catch(function(err){
            console.warn("Smth went wrong");
        
        });
    }


    //moro sam pokusat...
    function deleteRow(){
        fetch("https://jupitermobiletest.jupiter-software.com:30081/jupitermobilex/gen/api/food", {
            method : 'POST',
            body: JSON.stringify({
                "queries": [
                    {
                        "query" : "SpinCodeAcademy",
                        "params" : {
                            "action" : "getall",  //random pogado sta moze bit
                            "userid" : 5
                        }
                    }
                ]
            }),
            headers : {
            'Content-Type' : 'application/json'
            }
        }).then(function (response){
            if(response.ok){
                console.log("rrr");
                return response.json();
            }
        
        }).catch(function(err){
            console.warn("Smth went wrong");
        });
    }
    function getsmth(){
        
        fetch("https://jupitermobiletest.jupiter-software.com:30081/jupitermobilex/gen/api/food", {
            method : 'POST',
            body: JSON.stringify({
                "queries": [
                    {
                        "query" : "SpinCodeAcademy",
                        "params" : {
                            "action" : "getall",
                            "userid" : 5
                        }
                    }
                ]
            }),
            headers : {
            'Content-Type' : 'application/json'
            }
        }).then(function (response){
            if(response.ok){
                
                console.log("ok");
                return response.json();
            }
        }).then( function( data){
            allterms = data;
            console.log(data);
            setTable();
        }).catch(function(err){
            console.warn("Smth went wrong");
        });
    }


    function emptyTable(){
        var table = document.getElementById("tablica");
        
        for(let i=0;i<allterms.length;i++){
            table.deleteRow(0);
        }
    }


    function setTable(){
        var table = document.getElementById("tablica");
        
        
        console.log( allterms[0].Term);

        for (let i = 0; i < allterms.length; i++) {
            var row = table.insertRow(i+1);
            //console.log("red"+i);
            row.setAttribute('id', 'red'+i);
            var cell1 = row.insertCell(0);
            cell1.innerHTML = allterms[i].Term;

            var cell1 = row.insertCell(1);
            cell1.innerHTML = allterms[i].Description;

            var cell1 = row.insertCell(2);
            cell1.innerHTML = allterms[i].Username;
            //console.log(allterms[i].Description);
        }
    }
</script>
</html>